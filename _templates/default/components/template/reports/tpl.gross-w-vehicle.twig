{% extends 'tpl.container.twig' %}

{% import 'tpl.sidebar.twig' as sidebar %}
{% import 'tpl.topbar.twig' as topbar %}

{% block tpl_grid %}
	<div class="container-fluid">
		{{ sidebar.tpl_sidebar }}
		<div id="stage">
			{{ topbar.tpl_topbar }}
			<div id="content-container">
				<div id="content">
					<div class="report-table">
							<div class="header-content table-responsive">
								<table class="top-table report-duble">
									<tr>
										<td class="text-left">Deals:</td>
										<td class="txt-right">{{companytotal.deals}}</td>
										<td class="text-left">Total Gross:</td>
										{% if '(' in companytotal.total_gross %}
											<td class="tnum text-danger">
											{{companytotal.total_gross}}
											</td>
										{% else %}
											<td class="tnum">
											{{companytotal.total_gross}}
											</td>
										{% endif %}
										<td class="text-left">Front End:</td>
										{# <td class="txt-right">${{allfront| number_format(2, '.', ',')}}</td> #}
										{% if '(' in companytotal.frontend %}
											<td class="tnum text-danger">
											{{companytotal.frontend}}
											</td>
										{% else %}
											<td class="tnum">
											{{companytotal.frontend}}
											</td>
										{% endif %}
										<td class="text-left">Back End:</td>
										{# <td class="txt-right">${{allback| number_format(2, '.', ',')}}</td> #}
										{% if '(' in companytotal.backend %}
											<td class="tnum text-danger">
											{{companytotal.backend}}
											</td>
										{% else %}
											<td class="tnum">
											{{companytotal.backend}}
											</td>
										{% endif %}
									</tr>
									<tr>
										<td class="text-left">Finance Deals:</td>
										{% if '(' in companytotal.financed_deals %}
											<td class="tnum text-danger">
											{{companytotal.financed_deals}}
											</td>
										{% else %}
											<td class="tnum">
											{{companytotal.financed_deals}}
											</td>
										{% endif %}
										<td class="text-left">Amount Financed:</td>
										{% if '(' in companytotal.financed_total %}
											<td class="tnum text-danger">
											{{companytotal.financed_total}}
											</td>
										{% else %}
											<td class="tnum">
											{{companytotal.financed_total}}
											</td>
										{% endif %}
										<td class="text-left">Funded:</td>
										{% if '(' in companytotal.funded_total %}
											<td class="tnum text-danger">
											{{companytotal.funded_total}}
											</td>
										{% else %}
											<td class="tnum">
											{{companytotal.funded_total}}
											</td>
										{% endif %}
										<td class="text-left">Unfunded:</td>
										{% if '(' in companytotal.unfunded_total %}
											<td class="tnum text-danger">
											{{companytotal.unfunded_total}}
											</td>
										{% else %}
											<td class="tnum">
											{{companytotal.unfunded_total}}
											</td>
										{% endif %}
									</tr>
									{% if projects.deals > 0 %}
										<tr>
											<td class="text-left">Projected Deals:</td>
											<td class="txt-right">{{projects.deals}}</td>
											<td class="text-left">Projected Gross:</td>
											{# <td class="txt-right">{{projects.total_gross}}</td> #}
											{% if '(' in projects.total_gross %}
												<td class="tnum text-danger">
												{{projects.total_gross}}
												</td>
											{% else %}
												<td class="tnum">
												{{projects.total_gross}}
												</td>
											{% endif %}
											<td class="text-left">Projected Front End:</td>
											{# <td class="txt-right">{{projects.frontend}}</td> #}
											{% if '(' in projects.frontend %}
												<td class="tnum text-danger">
												{{projects.frontend}}
												</td>
											{% else %}
												<td class="tnum">
												{{projects.frontend}}
												</td>
											{% endif %}
											<td class="text-left">Projected Back End:</td>
											{# <td class="txt-right">{{projects.backend}}</td> #}
											{% if '(' in projects.backend %}
												<td class="tnum text-danger">
												{{projects.backend}}
												</td>
											{% else %}
												<td class="tnum">
												{{projects.backend}}
												</td>
											{% endif %}
										</tr>
									{% endif %}
								</table>
							</div>
							<br/>
							<div class="table-responsive">
								<table class="table table-striped">
									<tr>
										{# <th class="txt-center">Date Sold</th> #}
										{% if sortdir == "desc" and sortid == "date_sold" %}
										<th class="sortable tcen" onclick='javascript:sortColumn("date_sold", "asc")'>Date Sold
											<i class="fas fa-caret-down"></i>
										</th>
										{% else %}
										<th class="sortable tcen" onclick='javascript:sortColumn("date_sold", "desc")'>Date Sold
											<i class="fas fa-caret-up"></i>
										</th>
										{% endif %}
										{# <th class="txt-center">Client</th> #}
										{% if sortdir == "desc" and sortid == "client_name" %}
										<th class="sortable tcen" onclick='javascript:sortColumn("client_name", "asc")'>Client
											<i class="fas fa-caret-down"></i>
										</th>
										{% else %}
										<th class="sortable tcen" onclick='javascript:sortColumn("client_name", "desc")'>Client
											<i class="fas fa-caret-up"></i>
										</th>
										{% endif %}
										{# <th class="txt-center">Vehicle</th> #}
										{% if sortdir == "desc" and sortid == "vehicle" %}
										<th class="sortable tcen" onclick='javascript:sortColumn("vehicle", "asc")'>Vehicle
											<i class="fas fa-caret-down"></i>
										</th>
										{% else %}
										<th class="sortable tcen" onclick='javascript:sortColumn("vehicle", "desc")'>Vehicle
											<i class="fas fa-caret-up"></i>
										</th>
										{% endif %}
										{# <th class="txt-center">Stock</th> #}
										{% if sortdir == "desc" and sortid == "stock" %}
										<th class="sortable tcen" onclick='javascript:sortColumn("stock", "asc")'>Stock
											<i class="fas fa-caret-down"></i>
										</th>
										{% else %}
										<th class="sortable tcen" onclick='javascript:sortColumn("stock", "desc")'>Stock
											<i class="fas fa-caret-up"></i>
										</th>
										{% endif %}
										{# <th class="txt-center">Desk Manager</th> #}
										{% if sortdir == "desc" and sortid == "deskmanager" %}
										<th class="sortable tcen" onclick='javascript:sortColumn("deskmanager", "asc")'>Desk Manager
											<i class="fas fa-caret-down"></i>
										</th>
										{% else %}
										<th class="sortable tcen" onclick='javascript:sortColumn("deskmanager", "desc")'>Desk Manager
											<i class="fas fa-caret-up"></i>
										</th>
										{% endif %}
										{# <th class="txt-center">Finance Person</th> #}
										{% if sortdir == "desc" and sortid == "financeperson" %}
										<th class="sortable tcen" onclick='javascript:sortColumn("financeperson", "asc")'>Finance Person
											<i class="fas fa-caret-down"></i>
										</th>
										{% else %}
										<th class="sortable tcen" onclick='javascript:sortColumn("financeperson", "desc")'>Finance Person
											<i class="fas fa-caret-up"></i>
										</th>
										{% endif %}
										{# <th class="txt-center">Payable Gross</th> #}
										{% if sortdir == "desc" and sortid == "payable_gross" %}
										<th class="sortable tcen" onclick='javascript:sortColumn("payable_gross", "asc")'>Payable Gross
											<i class="fas fa-caret-down"></i>
										</th>
										{% else %}
										<th class="sortable tcen" onclick='javascript:sortColumn("payable_gross", "desc")'>Payable Gross
											<i class="fas fa-caret-up"></i>
										</th>
										{% endif %}
										{# <th class="txt-center">Front End</th> #}
										{% if sortdir == "desc" and sortid == "frontend" %}
										<th class="sortable tcen" onclick='javascript:sortColumn("frontend", "asc")'>Front End
											<i class="fas fa-caret-down"></i>
										</th>
										{% else %}
										<th class="sortable tcen" onclick='javascript:sortColumn("frontend", "desc")'>Front End
											<i class="fas fa-caret-up"></i>
										</th>
										{% endif %}
										{# <th class="txt-center">Back End</th> #}
										{% if sortdir == "desc" and sortid == "backend" %}
										<th class="sortable tcen" onclick='javascript:sortColumn("backend", "asc")'>Back End
											<i class="fas fa-caret-down"></i>
										</th>
										{% else %}
										<th class="sortable tcen" onclick='javascript:sortColumn("backend", "desc")'>Back End
											<i class="fas fa-caret-up"></i>
										</th>
										{% endif %}
										{# <th class="txt-center">Total Gross</th> #}
										{% if sortdir == "desc" and sortid == "total_gross" %}
										<th class="sortable tcen" onclick='javascript:sortColumn("total_gross", "asc")'>Total Gross
											<i class="fas fa-caret-down"></i>
										</th>
										{% else %}
										<th class="sortable tcen" onclick='javascript:sortColumn("total_gross", "desc")'>Total Gross
											<i class="fas fa-caret-up"></i>
										</th>
										{% endif %}
									</tr>
										{% for vehicle in vehicles %}
											<tr class="deal-row" data-id="{{ vehicle.deal_id }}" style="border-bottom: 1px solid #dadada">
												<td class="txt-center">{{ vehicle.date_sold_f|date("m/d/Y") }}</td>
												<td class="txt-center"><a href="deals/view?id={{vehicle.dealid}}" onclick="viewLender({{ vehicle.lender_id }})">{{ vehicle.client_name }}</a></td>
												<td class="txt-center">{{ vehicle.vehicle }}</td>
												<td class="txt-center">{{ vehicle.stock }}</td>
												<td class="txt-center">{{ vehicle.deskmanager }}</td>
												<td class="tnum">{{ vehicle.financeperson}}</td> 
												{% if '-' in vehicle.payable_gross %}
													<td class="tnum text-danger">
													$({{vehicle.payable_gross | replace({'-': ''}) | number_format(2, '.', ',') }})
													</td>
												{% else %}
													<td class="tnum">
													${{vehicle.payable_gross | number_format(2, '.', ',')}}
													</td>
												{% endif %}
												{# <td class="tnum">${{ front1| number_format(2, '.', ',') }}</td> #}
												{% if vehicle.frontend < 0 %}
													<td class="tnum text-danger">
													$({{vehicle.frontend | replace({'-': ''}) | number_format(2, '.', ',') }})
													</td>
												{% else %}
													<td class="tnum">
													${{vehicle.frontend | number_format(2, '.', ',')}}
													</td>
												{% endif %}
												{# <td class="tnum">${{ back1| number_format(2, '.', ',') }}</td> #}
												{% if vehicle.backend < 0  %}
													<td class="tnum text-danger">
													$({{vehicle.backend | replace({'-': ''}) | number_format(2, '.', ',') }})
													</td>
												{% else %}
													<td class="tnum">
													${{vehicle.backend | number_format(2, '.', ',')}}
													</td>
												{% endif %}
												{# <td class="tnum">${{ total1| number_format(2, '.', ',') }}</td>  #}
												{% if vehicle.total_gross < 0 %}
													<td class="tnum text-danger">
													$({{vehicle.total_gross | replace({'-': ''}) | number_format(2, '.', ',') }})
													</td>
												{% else %}
													<td class="tnum">
													${{vehicle.total_gross | number_format(2, '.', ',')}}
													</td>
												{% endif %}
											</tr>
										{% endfor %}
										<tr style="border-bottom: 1px solid #000000">
											<th class="txt-center">TOTAL</th>
											<th></th>
											<th></th>
											<th class="txt-center">{{companytotal.deals}}</th>
											<th></th>
											<th></th>
											{# <th class="tnum">${{VehicleTotal| number_format(2, '.', ',')}}</th> #}
											{% if '(' in companytotal.payable_gross %}
												<th class="tnum text-danger">
												{{companytotal.payable_gross}}
												</th>
											{% else %}
												<th class="tnum">
												{{companytotal.payable_gross}}
												</th>
											{% endif %}
											{# <th class="tnum">${{allfront| number_format(2, '.', ',')}}</th> #}
											{% if '(' in companytotal.frontend %}
												<th class="tnum text-danger">
												{{companytotal.frontend}}
												</th>
											{% else %}
												<th class="tnum">
												{{companytotal.frontend}}
												</th>
											{% endif %}
											{# <th class="tnum">${{allback| number_format(2, '.', ',')}}</th> #}
											{% if '(' in companytotal.backend %}
												<th class="tnum text-danger">
												{{companytotal.backend}}
												</th>
											{% else %}
												<th class="tnum">
												{{companytotal.backend}}
												</th>
											{% endif %}
											{# <th class="tnum">${{alltotal| number_format(2, '.', ',')}}</th> #}
											{% if '(' in companytotal.total_gross %}
												<th class="tnum text-danger">
												{{companytotal.total_gross}}
												</th>
											{% else %}
												<th class="tnum">
												{{companytotal.total_gross}}
												</th>
											{% endif %}
										</tr>
										<tr style="border-bottom: 1px solid #000000">
											<th class="txt-center">Average</th>
											<th></th>
											<th></th>
											<th class="txt-center"></th>
											<th></th>
											<th></th>
											{# <th class="tnum">${{average| number_format(2, '.', ',')}}</th> #}
											{% if '(' in companytotal.payable_gross_average %}
												<th class="tnum text-danger">
												{{companytotal.payable_gross_average}}
												</th>
											{% else %}
												<th class="tnum">
												{{companytotal.payable_gross_average}}
												</th>
											{% endif %}
											{# <th class="tnum">${{frontaverage| number_format(2, '.', ',')}}</th> #}
											{% if '(' in companytotal.frontend_average %}
												<th class="tnum text-danger">
												{{companytotal.frontend_average}}
												</th>
											{% else %}
												<th class="tnum">
												{{companytotal.frontend_average}}
												</th>
											{% endif %}
											{# <th class="tnum">${{backaverage| number_format(2, '.', ',')}}</th> #}
											{% if '(' in companytotal.backend_average %}
												<th class="tnum text-danger">
												{{companytotal.backend_average}}
												</th>
											{% else %}
												<th class="tnum">
												{{companytotal.backend_average}}
												</th>
											{% endif %}
											{# <th class="tnum">${{totalaverage| number_format(2, '.', ',')}}</th> #}
											{% if '(' in companytotal.total_gross_average %}
												<th class="tnum text-danger">
												{{companytotal.total_gross_average}}
												</th>
											{% else %}
												<th class="tnum">
												{{companytotal.total_gross_average}}
												</th>
											{% endif %}
										</tr>
										{% if projects %}
											<tr style="border-bottom: 1px solid #000000">
												<th class="txt-center">Projected</th>
												<th></th>
												<th></th>
												<th class="txt-center">{{projects.deals}}</th>
												<th></th>
												<th></th>
												<th class="tnum">{{projects.payable_gross}}</th>
												<th class="tnum">{{projects.frontend}}</th>
												<th class="tnum">{{projects.backend}}</th>
												<th class="tnum">{{projects.total_gross}}</th>
											</tr>
									{% endif %}
								</table>
							</div>
						<div class="modal fade" id="myModal" role="dialog">
							<div class="modal-dialog">
								<!-- Modal content-->
								<div class="modal-content">
									<div class="modal-header">
									<h3 class="modal-title1">Notes</h3>
									<button type="button" class="close" data-dismiss="modal">&times;</button>
									</div>
									<div class="modal-body">
									<p id = "NotesPanel">Some text in the modal.</p>
									</div>
									<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
									</div>
								</div>
							</div>
						</div>
						<script>
							function showModal (NotesString) {
								document.getElementById("NotesPanel").innerHTML = NotesString;
							}
						</script>
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}